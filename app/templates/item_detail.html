{% if session.get('user_id') %}
    {% extends "bidder.base.html" %}
{% else %}
    {% extends "base.html" %}
{% endif %}

{% block title %}{{ item.title }} - Online Bidding{% endblock %}

{% block content %}
<br><br>
<div class="container my-5 d-flex justify-content-center">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden" style="height: 50vh; max-width: 900px;">
        <div class="row g-0 h-100">
            <!-- Image Section -->
            <div class="col-md-6 h-100">
                <img 
                    src="{{ url_for('static', filename=item.img.replace('\\', '/').split('static/')[-1]) }}" 
                    alt="{{ item.title }}" 
                    class="img-fluid h-100 w-100 object-fit-cover">
            </div>

            <!-- Item Details -->
            <div class="col-md-6 d-flex flex-column p-4">
                <div>
                    <h2 class="fw-bold text-primary">{{ item.title }}</h2>
                    <p class="text-muted">{{ item.description }}</p>

                    <h4 class="text-success fw-bold mt-3">
                        Starting Price: ${{ "{:,.2f}".format(item.startingPrice) }}
                    </h4>

                    <div class="mt-2">
                        {% if item.isAuctionActive %}
                            <span class="badge bg-success fs-6 px-3 py-2">Auction Active</span>
                        {% else %}
                            <span class="badge bg-secondary fs-6 px-3 py-2">Auction Closed</span>
                        {% endif %}
                    </div>

                    <p class="mt-3 mb-1"><strong>Ends:</strong> 
                        {{ item.endTime if item.endTime != '0000-00-00 00:00:00' else 'No end date set' }}
                    </p>
                    <p class="mb-0"><strong>Seller ID:</strong> {{ item.USERID }}</p>
                </div>

                <!-- Bid Button -->
                {% if session.get('user_id') %}
                <div class="mt-auto">
                    <button class="btn btn-lg btn-warning w-100 fw-bold shadow-sm" 
                            data-bs-toggle="modal" 
                            data-bs-target="#bidModal" 
                            data-item-id="{{ item.ItemID }}" 
                            data-item-title="{{ item.title }}">
                        ðŸ’° Place Your Bid
                    </button>
                </div>
                {% else %}
                <div class="mt-auto">
                    <a href="{{ url_for('main.login') }}" 
                       class="btn btn-lg btn-warning w-100 fw-bold shadow-sm">
                        ðŸ’° Place Your Bid
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Bid Modal -->
{% if session.get('user_id') %}
<div class="modal fade" id="bidModal" tabindex="-1" aria-labelledby="bidModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('main.place_bid_new', item_id=item.ItemID) }}" id="bidForm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="bidModalLabel">Place a Bid</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="itemTitle" class="fw-bold"></p>
          <div class="mb-3">
            <label for="bid_amount" class="form-label">Bid Amount</label>
            <input type="number" class="form-control" id="bid_amount" name="bid_amount" min="1" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Submit Bid</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endif %}

<style>
    body {
        background-color: #f4f6f9;
    }
    .object-fit-cover {
        object-fit: cover;
    }
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
    var bidModal = document.getElementById('bidModal');
    if (bidModal) {
        bidModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var itemId = button.getAttribute('data-item-id');
            var itemTitle = button.getAttribute('data-item-title');
            document.getElementById('itemTitle').textContent = itemTitle;
            var bidForm = document.getElementById('bidForm');
            bidForm.action = "{{ url_for('main.place_bid_new', item_id=0) }}".replace('/0', '/' + itemId);
        });
    }
});
</script>
{% endblock %}
